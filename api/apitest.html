//apitest.html

<html>
<head>
	<title> API TEST </title>
<style>
path:hover{
  stroke-width:16px;
}
</style>
</head>
<body>


	<script src="../bower_components/d3/d3.min.js"></script>
	<script src="../bower_components/d3-topojson/d3-topojson.v1.min.js"></script>
	<script src="../bower_components/d3-tip/index.js"></script>
	<!--
	<script src='graphstruct.js'></script>
	<script src='segment-tree-browser.js'></script>
	<script src='gtfsdata.js'></script>
	<script src='plot.js'></script>
	<script src='pather.js'></script>
	<script src='mover.js'></script>
	-->
	<script src='fuzzyfixer.js'></script>
	<script src='nparse.js'></script>
	<script src='livegtfsapi.js'></script>
	<script>

			

			var fetcher = livegtfs.gtfsData;
			var el = d3.select('body').append('div');
			var plotter = livegtfs.plotter(el);
			var plotObj={};
				fetcher.getRouteTrips(109,'MONDAY',function(data){
						// var trips = data.trips;
						// var keys = Object.keys(trips);
						// keys.forEach(function(trip){
						// 	if(trip !== 'B20140608WKD_035350_F..N69R')
						// 		delete trips[trip];
						// })
						livegtfs.mover.tripSetter.setTrip(el,data,{start:'05:24:00',end:'06:49:00'});
				 })
				fetcher.getRoutes(109,function(rdata){
					console.log('routes',rdata);
					var junctions = plotter.junctionUtil.getJuncs(rdata);
					//plotter.plotRoutes(rdata,'plot',40)
					fetcher.getStops(109,{Type:'FeatureCollection'},function(sdata){
						console.log('stops',sdata);
						sdata = fuzzyfixer(rdata,sdata)
						plotter.junctionUtil.mergeJuncs(sdata,junctions);
						plotObj = {data:sdata,plotId:'plot',scaleFactor:40}			
						console.log(sdata);
						plotter.plotStops(sdata,'plot',40,junctions);
						livegtfs.pather.plotPaths(rdata.features,sdata.features,plotObj);

					});
				});

				
			

			
	</script>
