//apitest.html

<html>
<head>
	<title> API TEST </title>
<style>
	path:hover{
  stroke-width:16px;
}

</style>
</head>
<body>


	<script src="../bower_components/d3/d3.min.js"></script>
	<script src="../bower_components/d3-topojson/d3-topojson.v1.min.js"></script>
	<script src="../bower_components/d3-tip/index.js"></script>
	<!--
	<script src='graphstruct.js'></script>
	<script src='segment-tree-browser.js'></script>
	<script src='gtfsdata.js'></script>
	<script src='plot.js'></script>
	<script src='pather.js'></script>
	<script src='mover.js'></script>
	-->
	<script src='fuzzyfixer.js'></script>
	<script src='nparse.js'></script>
	<script src='livegtfsapi.js'></script>
	<script>

			

			var fetcher = livegtfs.gtfsData;
			var el = d3.select('body').append('div');
			var plotter = livegtfs.plotter(el);
			var plotObj={};
			var util = livegtfs.other;
				fetcher.getRouteTrips(12,'TUESDAY',function(data){
						// console.log(data);
						// var routes = data.intervalObj;
						// var keys = Object.keys(routes);
						// keys.forEach(function(r){

						// 	if(r === 'route_A'){
						// 		var trips = routes[r].trips;
						// 		ks = Object.keys(trips);
						// 		ks.forEach(function(t){
						// 			if(t !== "B20140608WKD_027700_A..N09R")
						// 				delete trips[t];
						// 		})
						// 	}else
						// 		delete routes[r]
						// })
						livegtfs.mover.tripSetter.setTrip(el,data,{start:'07:30:00',end:'08:00:00'});
				 })
				// fetcher.getRoutes(12,function(rdata){
				// 	console.log('routes',rdata);
				// 	var junctions = util.junctionUtil.getJuncs(rdata);
				// 	//rdata.features[rdata.features.length-1].geometry.coordinates.splice(1,1);
				// 	//plotter.plotRoutes(rdata,'plot',10000,'905-142')
				// 	fetcher.getStops(12,{Type:'FeatureCollection'},function(sdata){
				// 		console.log('stops',sdata);
				// 		sdata = fuzzyfixer(rdata,sdata)
				// 		util.junctionUtil.mergeJuncs(sdata,junctions);
				// 		plotObj = {data:sdata,plotId:'plot',scaleFactor:50}			
				// 		console.log(sdata);
				// 		// plotter.plotStops(sdata,'plot',50,junctions,'531-142');
				// 		livegtfs.pather.plotPaths(rdata.features,sdata.features,plotObj);
				// 	});
				// });

				fetcher.getSegmentData(12,function(segData){
					console.log(segData);
					var plotObj = {data:segData.stops,plotId:'plot',scaleFactor:50};
					livegtfs.pather.plotSegs(segData.segments,plotObj);
				})
				
			

			
	</script>
